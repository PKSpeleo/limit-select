<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LimitSelect - Pastel Design</title>
  <!-- Include Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
  /* Pastel Design Styles */
  body {
      background-color: #F5F5F5; /* Light gray background */
      color: #333333; /* Dark gray text */
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      font-size: 18px; /* Base font size for desktop */
  }

  h1, h2, label {
      color: #333333;
  }

  .container {
      padding: 20px;
      max-width: 800px; /* Limit width to 800px on desktop */
      margin: 0 auto; /* Center the container */
      box-sizing: border-box;
  }

  .item {
      display: flex;
      align-items: center;
      background-color: #FFFFFF; /* White background for items */
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #CCCCCC; /* Light gray border */
  }

  .item input[type="text"] {
      flex-grow: 1;
      margin: 0 10px;
      background-color: #FAFAFA; /* Very light gray background */
      border: 1px solid #CCCCCC;
      color: #333333;
      padding: 10px;
      border-radius: 4px;
      font-size: 18px;
  }

  .item input[type="text"]::placeholder {
      color: #999999;
  }

  /* Styles for the toggle switch */
  .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
      margin-right: 10px;
  }

  .switch input {
      opacity: 0;
      width: 0;
      height: 0;
  }

  .slider {
      position: absolute;
      cursor: pointer;
      background-color: #D3D3D3; /* Gray color when off */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      transition: .4s;
      border-radius: 34px;
  }

  .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      background-color: white;
      left: 4px;
      bottom: 4px;
      transition: .4s;
      border-radius: 50%;
  }

  input:checked + .slider {
      background-color: #A8D5BA; /* Soft green when on */
  }

  input:not(:checked) + .slider {
      background-color: #D3D3D3; /* Gray color when off */
  }

  input:checked + .slider:before {
      transform: translateX(26px);
  }

  .item button {
      background-color: #B3CDE0; /* Soft blue color */
      border: none;
      color: #333333;
      padding: 10px 14px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
  }

  .item button:hover {
      background-color: #9BB8D3;
  }

  #addItemButton {
      background-color: #C6AEC7; /* Soft purple color */
      border: none;
      color: #333333;
      padding: 14px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
      margin-top: 20px;
      width: 100%;
  }

  #addItemButton:hover {
      background-color: #B495B2;
  }

  #maxSelect {
      background-color: #FAFAFA;
      border: 1px solid #CCCCCC;
      color: #333333;
      padding: 10px;
      border-radius: 4px;
      width: 80px;
      margin-left: 10px;
      font-size: 18px;
  }

  label {
      font-size: 20px;
  }

  .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
  }

  .header h1 {
      margin: 0;
      font-size: 32px;
  }

  .header .max-select-container {
      display: flex;
      align-items: center;
      margin-top: 10px;
  }

  h2 {
      font-size: 24px;
      margin-top: 30px;
  }

  /* Scrollbar styles */
  ::-webkit-scrollbar {
      width: 8px;
  }

  ::-webkit-scrollbar-track {
      background: #E0E0E0;
  }

  ::-webkit-scrollbar-thumb {
      background: #C0C0C0;
      border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
      background: #A0A0A0;
  }

  /* Responsive design */
  @media (max-width: 600px) {
      body {
          font-size: 35px; /* Increase font size by 30% (from 27px to 35px) */
      }

      .item input[type="text"] {
          margin: 10px 0;
          font-size: 35px;
          padding: 20px;
      }

      .item button {
          width: 100%;
          margin-top: 10px;
          font-size: 31px;
          padding: 20px;
      }

      /* Increase size of the toggle switch on mobile devices */
      .switch {
          width: 90px;
          height: 51px;
      }

      .slider:before {
          height: 39px;
          width: 39px;
          left: 6px;
          bottom: 6px;
      }

      input:checked + .slider:before {
          transform: translateX(39px);
      }

      #addItemButton {
          font-size: 35px;
          padding: 28px 48px;
      }

      #maxSelect {
          font-size: 35px;
          padding: 20px;
          width: 120px;
      }

      label {
          font-size: 39px;
      }

      h1 {
          font-size: 62px;
      }

      h2 {
          font-size: 47px;
      }

      .header {
          flex-direction: column;
          align-items: flex-start;
      }

      .header .max-select-container {
          margin-left: 0;
          margin-top: 10px;
      }
  }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>LimitSelect</h1>
    <div class="max-select-container">
      <label for="maxSelect">Maximum number of selectable items:</label>
      <input type="number" id="maxSelect" value="2" min="1">
    </div>
  </div>

  <h2>Items</h2>
  <div id="itemsList">
    <!-- Items will be added here -->
  </div>

  <button id="addItemButton">Add Item</button>
</div>

<script>
const maxSelectInput = document.getElementById('maxSelect');
const itemsList = document.getElementById('itemsList');
const addItemButton = document.getElementById('addItemButton');
let itemCount = 0;
let selectedItems = [];
let itemsData = [];

// Functions for base64 encoding/decoding with Unicode support
function base64Encode(str) {
  const encoder = new TextEncoder();
  const bytes = encoder.encode(str);
  let binary = '';
  bytes.forEach((b) => binary += String.fromCharCode(b));
  return btoa(binary);
}

function base64Decode(str) {
  const binary = atob(str);
  const bytes = new Uint8Array(binary.length);
  for (let i = 0; i < binary.length; i++) {
    bytes[i] = binary.charCodeAt(i);
  }
  const decoder = new TextDecoder();
  return decoder.decode(bytes);
}

function updateURL() {
  const state = {
    maxSelect: maxSelectInput.value,
    items: itemsData.map(item => ({
      name: item.nameInput.value,
      selected: item.checkbox.checked
    }))
  };
  const stateString = JSON.stringify(state);
  const encodedState = base64Encode(stateString);
  const newURL = window.location.origin + window.location.pathname + '?state=' + encodeURIComponent(encodedState);
  window.history.replaceState(null, '', newURL);
}

function createItem(name = '', selected = false) {
  itemCount++;
  const itemDiv = document.createElement('div');
  itemDiv.className = 'item';

  // Create toggle switch
  const switchLabel = document.createElement('label');
  switchLabel.className = 'switch';

  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.id = 'itemCheckbox' + itemCount;
  checkbox.checked = selected;
  checkbox.addEventListener('change', handleCheckboxChange);

  const slider = document.createElement('span');
  slider.className = 'slider';

  switchLabel.appendChild(checkbox);
  switchLabel.appendChild(slider);

  const textInput = document.createElement('input');
  textInput.type = 'text';
  textInput.value = name;
  textInput.placeholder = 'Item Name';
  textInput.addEventListener('input', updateURL);

  const removeButton = document.createElement('button');
  removeButton.textContent = 'Remove';
  removeButton.addEventListener('click', () => {
    if (checkbox.checked) {
      selectedItems = selectedItems.filter(id => id !== checkbox.id);
    }
    itemsData = itemsData.filter(item => item.checkbox !== checkbox);
    itemsList.removeChild(itemDiv);
    updateURL();
  });

  itemDiv.appendChild(switchLabel);
  itemDiv.appendChild(textInput);
  itemDiv.appendChild(removeButton);
  itemsList.appendChild(itemDiv);

  if (checkbox.checked) {
    selectedItems.push(checkbox.id);
  }

  itemsData.push({
    checkbox: checkbox,
    nameInput: textInput
  });

  updateURL();
}

function handleCheckboxChange(event) {
  const maxSelect = parseInt(maxSelectInput.value);
  const checkbox = event.target;
  if (checkbox.checked) {
    selectedItems.push(checkbox.id);
    if (selectedItems.length > maxSelect) {
      const deselectId = selectedItems.shift();
      const deselectCheckbox = document.getElementById(deselectId);
      deselectCheckbox.checked = false;
    }
  } else {
    selectedItems = selectedItems.filter(id => id !== checkbox.id);
  }
  updateURL();
}

maxSelectInput.addEventListener('change', () => {
  // Deselect items if new max is less than the number of selected items
  const maxSelect = parseInt(maxSelectInput.value);
  while (selectedItems.length > maxSelect) {
    const deselectId = selectedItems.shift();
    const deselectCheckbox = document.getElementById(deselectId);
    deselectCheckbox.checked = false;
  }
  updateURL();
});

addItemButton.addEventListener('click', () => {
  createItem();
});

// Function to load state from URL
function loadStateFromURL() {
  const params = new URLSearchParams(window.location.search);
  const encodedState = params.get('state');
  if (encodedState) {
    try {
      const stateString = base64Decode(decodeURIComponent(encodedState));
      const state = JSON.parse(stateString);
      maxSelectInput.value = state.maxSelect;
      // Clear existing items
      itemsList.innerHTML = '';
      itemsData = [];
      selectedItems = [];
      itemCount = 0;
      state.items.forEach(item => {
        createItem(item.name, item.selected);
      });
      // Ensure selection limits are enforced after loading
      const maxSelect = parseInt(maxSelectInput.value);
      while (selectedItems.length > maxSelect) {
        const deselectId = selectedItems.shift();
        const deselectCheckbox = document.getElementById(deselectId);
        deselectCheckbox.checked = false;
      }
    } catch (e) {
      console.error('Failed to load state from URL:', e);
    }
  } else {
    // Initialize with a few items if no state is present
    createItem('Item 1');
    createItem('Item 2');
    createItem('Item 3');
  }
}

// Load state on page load
window.addEventListener('load', loadStateFromURL);
</script>

</body>
</html>
