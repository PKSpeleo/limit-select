<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LimitSelect - Dark Material Design</title>
  <!-- Include Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
  /* Dark Material Design Styles */
  body {
      background-color: #121212;
      color: #FFFFFF;
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      font-size: 18px; /* Base font size for desktop */
  }

  h1, h2, label {
      color: #FFFFFF;
  }

  .container {
      padding: 20px;
      max-width: 800px; /* Limit width to 800px on desktop */
      margin: 0 auto; /* Center the container */
      box-sizing: border-box;
  }

  .item {
      display: flex;
      align-items: center;
      background-color: #1E1E1E;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
  }

  .item input[type="text"] {
      flex-grow: 1;
      margin: 0 10px;
      background-color: #2C2C2C;
      border: none;
      color: #FFFFFF;
      padding: 10px;
      border-radius: 4px;
      font-size: 18px;
  }

  .item input[type="text"]::placeholder {
      color: #BBBBBB;
  }

  .item input[type="checkbox"] {
      transform: scale(1.5);
      margin-right: 10px;
      accent-color: #BB86FC;
  }

  .item button {
      background-color: #BB86FC;
      border: none;
      color: #FFFFFF;
      padding: 10px 14px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
  }

  .item button:hover {
      background-color: #9E6FF2;
  }

  #addItemButton {
      background-color: #03DAC6;
      border: none;
      color: #000000;
      padding: 14px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
      margin-top: 20px;
      width: 100%;
  }

  #addItemButton:hover {
      background-color: #01BDA5;
  }

  #maxSelect {
      background-color: #2C2C2C;
      border: none;
      color: #FFFFFF;
      padding: 10px;
      border-radius: 4px;
      width: 80px;
      margin-left: 10px;
      font-size: 18px;
  }

  label {
      font-size: 20px;
  }

  .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
  }

  .header h1 {
      margin: 0;
      font-size: 32px;
  }

  .header .max-select-container {
      display: flex;
      align-items: center;
      margin-top: 10px;
  }

  h2 {
      font-size: 24px;
      margin-top: 30px;
  }

  /* Scrollbar styles */
  ::-webkit-scrollbar {
      width: 8px;
  }

  ::-webkit-scrollbar-track {
      background: #1E1E1E;
  }

  ::-webkit-scrollbar-thumb {
      background: #3C3C3C;
      border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
      background: #555;
  }

  /* Responsive Design */
  @media (max-width: 600px) {
      body {
          font-size: 27px; /* Increase font size by 50% (18px * 1.5) */
      }

      .item input[type="text"] {
          margin: 10px 0;
          font-size: 27px; /* Increase font size by 50% */
          padding: 15px;
      }

      .item button {
          width: 100%;
          margin-top: 10px;
          font-size: 24px; /* Increase font size by 50% */
          padding: 15px;
      }

      .item input[type="checkbox"] {
          transform: scale(2); /* Increase checkbox size */
      }

      #addItemButton {
          font-size: 27px; /* Increase font size by 50% */
          padding: 21px 36px;
      }

      #maxSelect {
          font-size: 27px; /* Increase font size by 50% */
          padding: 15px;
          width: 100px;
      }

      label {
          font-size: 30px; /* Increase font size by 50% */
      }

      h1 {
          font-size: 48px; /* Increase font size by 50% */
      }

      h2 {
          font-size: 36px; /* Increase font size by 50% */
      }

      .header {
          flex-direction: column;
          align-items: flex-start;
      }

      .header .max-select-container {
          margin-left: 0;
          margin-top: 10px;
      }
  }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>LimitSelect</h1>
    <div class="max-select-container">
      <label for="maxSelect">Max selectable items:</label>
      <input type="number" id="maxSelect" value="2" min="1">
    </div>
  </div>

  <h2>Items</h2>
  <div id="itemsList">
    <!-- Items will be added here -->
  </div>

  <button id="addItemButton">Add Item</button>
</div>

<script>
const maxSelectInput = document.getElementById('maxSelect');
const itemsList = document.getElementById('itemsList');
const addItemButton = document.getElementById('addItemButton');
let itemCount = 0;
let selectedItems = [];
let itemsData = [];

// Functions to handle base64 encoding/decoding with Unicode support
function base64Encode(str) {
  const encoder = new TextEncoder();
  const bytes = encoder.encode(str);
  let binary = '';
  bytes.forEach((b) => binary += String.fromCharCode(b));
  return btoa(binary);
}

function base64Decode(str) {
  const binary = atob(str);
  const bytes = new Uint8Array(binary.length);
  for (let i = 0; i < binary.length; i++) {
    bytes[i] = binary.charCodeAt(i);
  }
  const decoder = new TextDecoder();
  return decoder.decode(bytes);
}

function updateURL() {
  const state = {
    maxSelect: maxSelectInput.value,
    items: itemsData.map(item => ({
      name: item.nameInput.value,
      selected: item.checkbox.checked
    }))
  };
  const stateString = JSON.stringify(state);
  const encodedState = base64Encode(stateString);
  const newURL = window.location.origin + window.location.pathname + '?state=' + encodeURIComponent(encodedState);
  window.history.replaceState(null, '', newURL);
}

function createItem(name = '', selected = false) {
  itemCount++;
  const itemDiv = document.createElement('div');
  itemDiv.className = 'item';

  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.id = 'itemCheckbox' + itemCount;
  checkbox.checked = selected;
  checkbox.addEventListener('change', handleCheckboxChange);

  const textInput = document.createElement('input');
  textInput.type = 'text';
  textInput.value = name;
  textInput.placeholder = 'Item Name';
  textInput.addEventListener('input', updateURL);

  const removeButton = document.createElement('button');
  removeButton.textContent = 'Remove';
  removeButton.addEventListener('click', () => {
    if (checkbox.checked) {
      selectedItems = selectedItems.filter(id => id !== checkbox.id);
    }
    itemsData = itemsData.filter(item => item.checkbox !== checkbox);
    itemsList.removeChild(itemDiv);
    updateURL();
  });

  itemDiv.appendChild(checkbox);
  itemDiv.appendChild(textInput);
  itemDiv.appendChild(removeButton);
  itemsList.appendChild(itemDiv);

  if (checkbox.checked) {
    selectedItems.push(checkbox.id);
  }

  itemsData.push({
    checkbox: checkbox,
    nameInput: textInput
  });

  updateURL();
}

function handleCheckboxChange(event) {
  const maxSelect = parseInt(maxSelectInput.value);
  const checkbox = event.target;
  if (checkbox.checked) {
    selectedItems.push(checkbox.id);
    if (selectedItems.length > maxSelect) {
      const deselectId = selectedItems.shift();
      const deselectCheckbox = document.getElementById(deselectId);
      deselectCheckbox.checked = false;
    }
  } else {
    selectedItems = selectedItems.filter(id => id !== checkbox.id);
  }
  updateURL();
}

maxSelectInput.addEventListener('change', () => {
  // Deselect items if new max is less than the number of selected items
  const maxSelect = parseInt(maxSelectInput.value);
  while (selectedItems.length > maxSelect) {
    const deselectId = selectedItems.shift();
    const deselectCheckbox = document.getElementById(deselectId);
    deselectCheckbox.checked = false;
  }
  updateURL();
});

addItemButton.addEventListener('click', () => {
  createItem();
});

// Function to load state from URL
function loadStateFromURL() {
  const params = new URLSearchParams(window.location.search);
  const encodedState = params.get('state');
  if (encodedState) {
    try {
      const stateString = base64Decode(decodeURIComponent(encodedState));
      const state = JSON.parse(stateString);
      maxSelectInput.value = state.maxSelect;
      // Clear existing items
      itemsList.innerHTML = '';
      itemsData = [];
      selectedItems = [];
      itemCount = 0;
      state.items.forEach(item => {
        createItem(item.name, item.selected);
      });
      // Ensure selection limits are enforced after loading
      const maxSelect = parseInt(maxSelectInput.value);
      while (selectedItems.length > maxSelect) {
        const deselectId = selectedItems.shift();
        const deselectCheckbox = document.getElementById(deselectId);
        deselectCheckbox.checked = false;
      }
    } catch (e) {
      console.error('Failed to load state from URL:', e);
    }
  } else {
    // Initialize with a few items if no state is present
    createItem('Item 1');
    createItem('Item 2');
    createItem('Item 3');
  }
}

// Load state on page load
window.addEventListener('load', loadStateFromURL);
</script>

</body>
</html>
